/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */

define("ball",[],function(){var t=function(){this.renderer=null,this.stage=null,this.container=null,this.spriteTex=null,this.divCounter=null,this.divCounterSuffix=" balls",this.sprites=[],this.incremental=50,this.isAdding=!1,this.canWidth=0,this.canHeight=0,this.ntf=null,this.isStarted=!1};return t.prototype={init:function(t){console.log("BallMgr::init()"),this.renderer=t.renderer,this.stage=t.stage,this.ntf=t.notifications,this.divCounter=document.createElement("div"),this.divCounter.className="counter",this.container=new PIXI.SpriteBatch,this.spriteTex=new PIXI.Texture.fromImage("ball32.png");for(var i=0;2>i;i++){var e=this.createSprite();this.sprites.push(e),this.container.addChild(e)}this.divCounterSuffix+=this.renderer instanceof PIXI.WebGLRenderer?"(W)":"(C)"},start:function(){this.isStarted||(this.isStarted=!0,document.body.appendChild(this.divCounter),this.stage.addChild(this.container),this.ntf.mouseDown.add(t.prototype.onKeyDown,this),this.ntf.mouseUp.add(t.prototype.onKeyUp,this),this.ntf.resize.add(t.prototype.onResize,this),this.ntf.update.add(t.prototype.onUpdate,this),this.updateCounter())},stop:function(){this.isStarted&&(this.isStarted=!1,document.body.removeChild(this.divCounter),this.stage.removeChild(this.container),this.sprites.length>2&&(this.container.removeChildren(2),this.sprites.splice(2,this.sprites.length-2)),this.ntf.mouseDown.remove(t.prototype.onKeyDown,this),this.ntf.mouseUp.remove(t.prototype.onKeyUp,this),this.ntf.resize.remove(t.prototype.onResize,this),this.ntf.update.remove(t.prototype.onUpdate,this))},onKeyDown:function(){this.isAdding=!0},onKeyUp:function(){this.isAdding=!1},onResize:function(t,i){if(this.canWidth=t,this.canHeight=i,this.renderer){var e=this.renderer.view.offsetLeft,n=this.renderer.view.offsetTop;this.divCounter.style.left=e+"px",this.divCounter.style.top=n+50+"px",this.updateCounter()}},onUpdate:function(){if(this.isAdding){for(var t=0;t<this.incremental;t++){var i=this.createSprite();this.sprites.push(i),this.container.addChild(i)}this.updateCounter()}for(var t=0,e=this.sprites.length;e>t;t++){var i=this.sprites[t];i.position.x+=i.speedX,i.position.y+=i.speedY,i.speedY+=.75,i.rotation+=.1,i.position.x>this.canWidth?(i.speedX*=-1,i.position.x=this.canWidth):i.position.x<0&&(i.speedX*=-1,i.position.x=0),i.position.y>this.canHeight?(i.speedY*=-.85,i.position.y=this.canHeight,Math.random()>.5&&(i.speedY-=6*Math.random())):i.position.y<0&&(i.speedY=0,i.position.y=0)}},updateCounter:function(){this.divCounter.innerHTML=this.sprites.length+this.divCounterSuffix},createSprite:function(){var t=new PIXI.Sprite(this.spriteTex);return t.speedX=10*Math.random(),t.speedY=10*Math.random()-5,t.anchor.x=.5,t.anchor.y=.5,t}},{createMgr:function(){return new t}}}),define("dragon",[],function(){var t=function(){this.renderer=null,this.stage=null,this.canWidth=0,this.canHeight=0,this.imgWidth=1286,this.imgHeight=640,this.assetLoader=null,this.background=null,this.background2=null,this.background3=null,this.foreground=null,this.foreground2=null,this.foreground3=null,this.dragon=null,this.ntf=null,this.sliderbar=null,this.bigNumber=Math.pow(10,4),this.started=!1};return t.prototype.constructor=t,t.prototype={init:function(t){this.renderer=t.renderer,this.stage=t.stage,this.ntf=t.notifications,this.canWidth=this.renderer.view.width,this.canHeight=this.renderer.view.height,this.assetLoader=new PIXI.AssetLoader(["data/bgtile.jpg","data/ground.png","data/dragonbones.json","data/dragonbones.anim"]);var i=this;this.assetLoader.on("onComplete",function(){i.background=PIXI.Sprite.fromImage("data/bgtile.jpg"),i.background2=PIXI.Sprite.fromImage("data/bgtile.jpg"),i.background3=PIXI.Sprite.fromImage("data/bgtile.jpg"),i.foreground=PIXI.Sprite.fromImage("data/ground.png"),i.foreground2=PIXI.Sprite.fromImage("data/ground.png"),i.foreground3=PIXI.Sprite.fromImage("data/ground.png"),i.dragon=new PIXI.Spine("data/dragonbones.anim"),i.dragon.position.x=i.imgWidth/3,i.dragon.position.y=i.imgHeight-i.dragon.height/2,i.dragon.scale.x=i.dragon.scale.y=.5,i.dragon.anchor=new PIXI.Point(.5,.5),i.dragon.state.setAnimationByName("flying",!0)}),this.assetLoader.load()},start:function(){var i=this;if(this.started)return!0;this.started=!0,this.showSlider();var e=function(){i.stage.addChild(i.background),i.stage.addChild(i.background2),i.stage.addChild(i.background3),i.stage.addChild(i.foreground),i.stage.addChild(i.foreground2),i.stage.addChild(i.foreground3),i.foreground.position.y=i.foreground2.position.y=i.foreground3.position.y=640-i.foreground2.height,i.stage.addChild(i.dragon),i.ntf.update.add(t.prototype.onUpdate,i),i.ntf.resize.add(t.prototype.onResize,i),i.ntf.keyDown.add(t.prototype.onKeyDown,i),i.ntf.keyUp.add(t.prototype.onKeyUp,i)};i.assetLoader.loadCount>0?i.assetLoader.on("onComplete",function(){e()}):e()},stop:function(){this.started&&(this.started=!1,this.hideSlider(),this.stage.removeChild(this.background),this.stage.removeChild(this.background2),this.stage.removeChild(this.background3),this.stage.removeChild(this.foreground),this.stage.removeChild(this.foreground2),this.stage.removeChild(this.foreground3),this.stage.removeChild(this.dragon),this.ntf.update.remove(t.prototype.onUpdate,this),this.ntf.resize.remove(t.prototype.onResize,this),this.ntf.keyDown.remove(t.prototype.onKeyDown,this),this.ntf.keyUp.remove(t.prototype.onKeyUp,this))},onKeyDown:function(t){38===t.keyCode?(this.dragon.position.y-=5,this.dragon.position.y<this.dragon.height&&(this.dragon.position.y=this.dragon.height)):40===t.keyCode&&(this.dragon.position.y+=5,this.dragon.position.y>this.imgHeight&&(this.dragon.position.y=this.imgHeight))},onKeyUp:function(){},onResize:function(t,i){this.canWidth=t,this.canHeight=i,this.imgWidth>this.canWidth?(this.stage.children.indexOf(this.background3)>=0&&(this.stage.removeChild(this.background3),this.background.position.x=0),this.stage.children.indexOf(this.foreground3)>=0&&(this.stage.removeChild(this.foreground3),this.foreground.position.x=0)):(-1===this.stage.children.indexOf(this.background3)&&(this.stage.addChildAt(this.background3,this.stage.getChildIndex(this.foreground)),this.background.position.x=0),-1===this.stage.children.indexOf(this.foreground3)&&(this.stage.addChildAt(this.foreground3,this.stage.getChildIndex(this.foreground2)),this.foreground3.position.y=640-this.foreground3.height,this.foreground.position.x=0))},onUpdate:function(){var t=this;t.factorial(t.bigNumber);var i=function(i,e,n,s){i.position.x-=s,t.imgWidth<this.canWidth?(i.position.x+3*t.imgWidth<t.canWidth&&(i.position.x+=3*t.imgWidth),i.position.x>0?(n.position.x=i.position.x-t.imgWidth,e.position.x=i.position.x+t.imgWidth>t.canWidth?i.position.x-2*t.imgWidth:i.position.x+t.imgWidth):(e.position.x=i.position.x+t.imgWidth,n.position.x=i.position.x+2*t.imgWidth)):(i.position.x+2*t.imgWidth<t.canWidth&&(i.position.x+=2*t.imgWidth),e.position.x=i.position.x>0?i.position.x-t.imgWidth:i.position.x+t.imgWidth)};i(this.background,this.background2,this.background3,6),i(this.foreground,this.foreground2,this.foreground3,10)},showSlider:function(){var t=this;if(!this.sliderbar){var i='<div id="sliderContainer" style="position:absolute; visibility:hidden;"><p><input type="text" id="slideramount" readonly style="border:0; opacity:0.4; width:50px;"></p><div id="divSliderbar" style="height:100px; width:8px;"></div></div>';$("body").append(i),this.sliderbar=$("#sliderContainer"),this.sliderbar.offset({left:20,top:60}),$("#divSliderbar").slider({orientation:"vertical",range:"min",min:t.bigNumber,max:Math.pow(10,6),value:t.bigNumber,slide:function(i,e){$("#slideramount").val(e.value),t.bigNumber=e.value}}),$("#slideramount").val($("#divSliderbar").slider("value"))}this.sliderbar.css("visibility","visible")},hideSlider:function(){this.sliderbar&&this.sliderbar.css("visibility","hidden")},isPrime:function(t,i){if("fast"===i){if(isNaN(t)||!isFinite(t)||t%1||2>t)return!1;if(t%2==0)return 2==t;if(t%3==0)return 3==t;for(var e=Math.sqrt(t),n=5;e>=n;n+=6){if(t%n==0)return!1;if(t%(n+2)==0)return!1}return!0}if("middle"===i){if(isNaN(t)||!isFinite(t)||t%1||2>t)return!1;if(t%2==0)return 2==t;for(var e=Math.sqrt(t),n=3;e>=n;n+=2)if(t%n==0)return!1;return!0}if(isNaN(t)||!isFinite(t)||t%1||2>t)return!1;for(var e=Math.sqrt(t),n=2;e>=n;n++)if(t%n==0)return!1;return!0},factorial:function(t){for(var i=1,e=2;t>=e;e++)this.isPrime(e)&&(i*=e);return i}},{createInstance:function(){return new t}}}),function(t){function i(t,i,e,n,s){this._listener=i,this._isOnce=e,this.context=n,this._signal=t,this._priority=s||0}function e(t,i){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",i))}function n(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){n.prototype.dispatch.apply(t,arguments)}}i.prototype={active:!0,params:null,execute:function(t){var i,e;return this.active&&this._listener&&(e=this.params?this.params.concat(t):t,i=this._listener.apply(this.context,e),this._isOnce&&this.detach()),i},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},n.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(t,e,n,s){var o,r=this._indexOfListener(t,n);if(-1!==r){if(o=this._bindings[r],o.isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else o=new i(this,t,e,n,s),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(t){var i=this._bindings.length;do--i;while(this._bindings[i]&&t._priority<=this._bindings[i]._priority);this._bindings.splice(i+1,0,t)},_indexOfListener:function(t,i){for(var e,n=this._bindings.length;n--;)if(e=this._bindings[n],e._listener===t&&e.context===i)return n;return-1},has:function(t,i){return-1!==this._indexOfListener(t,i)},add:function(t,i,n){return e(t,"add"),this._registerListener(t,!1,i,n)},addOnce:function(t,i,n){return e(t,"addOnce"),this._registerListener(t,!0,i,n)},remove:function(t,i){e(t,"remove");var n=this._indexOfListener(t,i);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),t},removeAll:function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var t,i=Array.prototype.slice.call(arguments),e=this._bindings.length;if(this.memorize&&(this._prevParams=i),e){t=this._bindings.slice(),this._shouldPropagate=!0;do e--;while(t[e]&&this._shouldPropagate&&t[e].execute(i)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var s=n;s.Signal=n,"function"==typeof define&&define.amd?define("lib/signals",[],function(){return s}):"undefined"!=typeof module&&module.exports?module.exports=s:t.signals=s}(this),requirejs.config({baseUrl:".",paths:{lib:"lib"}}),requirejs(["ball","dragon","lib/signals"],function(t,i,e){var n={ball:"ball",dragon:"dragon"},s=n.dragon,o={};o.notifications={mouseDown:new e.Signal,mouseUp:new e.Signal,mouseMove:new e.Signal,touchStart:new e.Signal,touchEnd:new e.Signal,keyDown:new e.Signal,keyUp:new e.Signal,resize:new e.Signal,update:new e.Signal};var r=$(window).width(),d=$(window).height(),a=new PIXI.autoDetectRenderer(r,d);a instanceof PIXI.WebGLRenderer?console.log("PIXI is using WebGL as renderer engine"):(console.log("PIXI is using Canvas 2D as Renderer engine"),a.context.mozImageSmoothingEnabled=!1,a.context.webkitImageSmoothingEnabled=!1),a.view.className="rendererView",o.renderer=a;var h=new PIXI.Stage(16777215);o.stage=h,document.body.appendChild(a.view),a.view.style.position="absolute";var u=new Stats;document.body.appendChild(u.domElement),u.domElement.style.position="absolute",u.domElement.style.top="0px";var g=t.createMgr();g.init(o);var l=i.createInstance();l.init(o),$(a.view).mousedown(function(t){o.notifications.mouseDown.dispatch(t)}),$(a.view).mouseup(function(t){o.notifications.mouseUp.dispatch(t)}),document.addEventListener("touchstart",function(t){console.log("touchstart"),o.notifications.touchStart.dispatch(t)},!0),document.addEventListener("touchend",function(t){console.log("touchend"),o.notifications.touchEnd.dispatch(t)},!0),document.addEventListener("keydown",function(t){o.notifications.keyDown.dispatch(t)},!0),document.addEventListener("keyup",function(t){o.notifications.keyUp.dispatch(t)},!0);var p=function(){u.begin(),o.notifications.update.dispatch(),a.render(h),requestAnimFrame(p),u.end()},c=function(){canWidth=$(window).width(),canHeight=$(window).height();var t=10,i=10,e=canWidth-20,n=canHeight-20;a.view.style.left=t+"px",a.view.style.top=i+"px",a.view.style.width=e+"px",a.view.style.height=n+"px",a.resize(e,n),u.domElement.style.left=t+"px",u.domElement.style.top=i+"px",o.notifications.resize.dispatch(e,n)};$(window).resize(c);var f=function(){g.stop(),l.stop(),s===n.ball?g.start():s===n.dragon&&l.start(),c()};o.notifications.keyDown.add(function(t){t.keyCode==="B".charCodeAt(0)?(s=n.ball,f()):t.keyCode==="D".charCodeAt(0)?(s=n.dragon,f()):t.keyCode==="R".charCodeAt(0)&&c()}),f(),c(),p()}),define("main",function(){});